# Feature Specification: Import & Extraction Engine

**Feature Branch**: `031-import-file-content`
**Created**: 2026-02-01
**Status**: Draft
**Input**: User description: "We should be able to import various files (jsons, pure text, word doc, pdfs) and extract content (and art and connections) for auto import into codex"

## User Scenarios & Testing

### User Story 1 - Intelligent Source Processing (Priority: P1)

As a World Builder, I want to upload a file (PDF, DOCX, TXT) and have the Oracle analyze and extract its contents into one or more Codex Nodes so that a single "Lore Bible" file can be automatically split into its constituent characters, locations, and chapters.

**Why this priority**: Transforming legacy monolithic documents into a graph structure is the primary value proposition of the import feature.

**Independent Test**: Upload a single PDF containing descriptions of 3 different Cities; verify the Oracle creates 3 separate Location Nodes, one for each city.

**Acceptance Scenarios**:

1. **Given** a source file, **When** processed, **Then** the Oracle analyzes the structure and content to determine logical boundaries (e.g., sections, headers, distinct entities).
2. **Given** the analysis, **Then** the Oracle generates separate Markdown Entity files for each identified distinct topic or section.
3. **If** a file represents a single cohesive object (e.g., a letter found in-game), **Then** it creates a single Node.

### User Story 2 - Image/Art Extraction (Priority: P2)

As a World Builder, I want images embedded within my imported document to be extracted and saved as assets so that the visual context of my lore is preserved in the Codex.

**Why this priority**: Visuals are critical for world-building (maps, character art) and difficult to migrate manually.

**Independent Test**: Import a DOCX containing an image; verify the image is saved to the asset store and displayed within the created Node.

**Acceptance Scenarios**:

1. **Given** a DOCX/PDF with embedded images, **When** imported, **Then** the images are extracted to the local media folder.
2. **Given** an extracted image, **When** the Node is created, **Then** an image reference (Markdown image link) is inserted into the Node content at the approximate original location.

### User Story 3 - Automatic Connection Discovery (Priority: P3)

As a World Builder, I want the system to identify relationships in the imported text using the Oracle's understanding so that my new content is intelligently woven into the existing graph, even if exact keywords are missing.

**Why this priority**: Saves significant time manually linking new notes to existing ones and finds connections a simple text search might miss.

**Independent Test**: Import a text file describing a "Shadowy Figure" that implies a connection to an existing "Thieves Guild" node without naming it explicitly; verify the Oracle suggests or creates a link.

**Acceptance Scenarios**:

1. **Given** text containing references to existing entities, **When** imported, **Then** the Oracle analyzes the content and creates semantic links to those entities.
2. **Given** text containing implied relationships, **When** processed, **Then** the Oracle identifies these potential connections.

### User Story 4 - Intelligent Entity Generation (Priority: P2)

As a Data Manager, I want the Oracle to analyze my imported file and automatically generate the appropriate Codex Markdown files (Entities) so that I don't have to manually create and format them.

**Why this priority**: Allows for importing diverse "messy" data sources and getting immediately usable Codex Nodes.

**Independent Test**: Import a JSON file containing a list of NPCs; verify that 5 separate Markdown files are created in the Characters folder, one for each NPC.

**Acceptance Scenarios**:

1. **Given** a source file, **When** imported, **Then** the Oracle analyzes the content to identify distinct entities.
2. **Given** the analysis, **Then** the Oracle generates a valid Markdown file with Frontmatter for each identified entity.
3. **If** the source file contains multiple entities (e.g., a list), **Then** multiple Markdown files are generated.

## Requirements

### Functional Requirements

- **FR-001**: System MUST accept file uploads for `.pdf`, `.docx`, `.txt`, and `.json` extensions.
- **FR-002**: System MUST parse `.docx` files, converting content to Markdown (preserving headers, lists, bold, italic).
- **FR-003**: System MUST parse `.pdf` files, extracting text content (OCR not required for MVP, text-layer only).
- **FR-004**: System MUST extract embedded raster images from `.docx` and `.pdf` files.
- **FR-005**: Extracted images MUST be saved to the project's media storage (e.g., OPFS or local assets) with unique filenames.
- **FR-006**: System MUST persist the Entity files generated by the Oracle to the project's storage.
- **FR-007**: System MUST invoke the Oracle to analyze imported text for Entity mentions and semantic relationships, inserting these as Wiki-links within the generated Markdown content.
- **FR-008**: System MUST utilize the Oracle to process input content (analyzing structure and context) and generate one or more fully formatted Markdown files (with YAML frontmatter) representing the identified Entities.

### Key Entities

- **Source File**: The original external file (PDF/Doc/etc.).
- **Extracted Asset**: An image or media file pulled from a Source File.

## Success Criteria

### Measurable Outcomes

- **SC-001**: 95% of standard DOCX/PDF text content is extracted accurately (no missing paragraphs).
- **SC-002**: Embedded images are extracted and linked in 100% of supported DOCX files.
- **SC-003**: Import of a single document (< 5MB) completes in under 3 seconds.
- **SC-004**: Users can successfully migrate a "Lore Bible" (mixed text/images) without manual reformatting.