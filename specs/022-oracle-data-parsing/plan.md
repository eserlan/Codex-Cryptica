# Implementation Plan: Intelligent Oracle Data Separation

**Branch**: `022-oracle-data-parsing` | **Date**: 2026-01-30 | **Spec**: [/specs/022-oracle-data-parsing/spec.md](./spec.md)
**Input**: Feature specification from `/specs/022-oracle-data-parsing/spec.md`

## Summary

Implement an intelligent parsing layer between the Oracle's generative output and the application's data model. This feature will automatically split AI-generated content into "Chronicle" (short summary) and "Lore" (detailed history) fields, updating the node details panel in one click. The technical approach involves a pure functional parser that prioritizes Markdown headers (`## Chronicle`, `## Lore`) and falls back to a heuristic (first paragraph) for unstructured text.

## Technical Context

**Language/Version**: TypeScript 5.x / Node.js 20+  
**Primary Dependencies**: Svelte 5 (UI Framework), `packages/editor-core` (for content handling logic)  
**Storage**: OPFS (Markdown files with YAML frontmatter)  
**Testing**: Vitest (unit tests for parser), Playwright (E2E for UI integration)  
**Target Platform**: Web (PWA)
**Project Type**: Monorepo (Web App + Packages)  
**Performance Goals**: Sub-100ms UI update after "Apply" click  
**Constraints**: Offline-capable, must preserve Markdown formatting, pure functional logic for parsing  
**Scale/Scope**: Impacts Oracle integration and Node Details UI

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

1. **Local-First Sovereignty**: PASSED. Updates local Markdown/YAML data.
2. **Relational-First Navigation**: PASSED. Enhances node metadata within the graph.
3. **Sub-100ms Performance**: PASSED. Parser logic is lightweight; Svelte stores handle instant UI updates.
4. **Atomic Worldbuilding**: PASSED. Parser will be implemented as a pluggable utility in `packages/editor-core`.
5. **System-Agnostic Core**: PASSED. Parsing logic is based on content structure, not specific TTRPG rules.
6. **Pure Functional Core**: PASSED. The core separation logic will be a pure function.
7. **Verifiable Reality**: PASSED. Unit tests mandated for the parser.
8. **Test-First PWA Integrity**: PASSED. Logic is client-side and offline-capable.

## Project Structure

### Documentation (this feature)

```text
specs/022-oracle-data-parsing/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
└── tasks.md             # Phase 2 output (generated by speckit.tasks)
```

### Source Code (repository root)

```text
apps/web/
├── src/
│   ├── lib/
│   │   ├── components/
│   │   │   └── oracle/    # Oracle UI updates for preview/apply
│   │   └── stores/        # Node data stores updates

packages/editor-core/
├── src/
│   ├── parsing/           # NEW: Intelligent Oracle output parser
│   └── utils/

packages/schema/
├── src/
│   └── node.ts            # Ensure Chronicle/Lore types are robust
```

**Structure Decision**: The parsing logic belongs in `packages/editor-core` to remain reusable and testable in isolation. UI components in `apps/web` will consume this utility.

## Complexity Tracking

_No violations identified._